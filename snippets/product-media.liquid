{% assign selected_variant = product.selected_or_first_available_variant %}

<div class="product-media">
  <div class="product-media__container">
    {% if product.featured_image %}
      <div class="product-media__main">
        <img
          src="{{ selected_variant.featured_image | default: product.featured_image | image_url: width: 800 }}"
          alt="{{ selected_variant.featured_image.alt | default: product.featured_image.alt | default: product.title | escape }}"
          width="800"
          height="800"
          loading="eager"
          class="product-media__image"
          id="product-featured-image"
        >
      </div>

      {% if product.images.size > 1 %}
        <div class="product-media__thumbnails">
          {% for image in product.images limit: 4 %}
            <button
              type="button"
              class="product-media__thumbnail {% if forloop.first %}active{% endif %}"
              data-image-url="{{ image | image_url: width: 800 }}"
              aria-label="{{ 'products.product.media.view_image' | t }} {{ forloop.index }}"
            >
              <img
                src="{{ image | image_url: width: 150 }}"
                alt="{{ image.alt | default: product.title | escape }}"
                width="150"
                height="150"
                loading="lazy"
              >
            </button>
          {% endfor %}
        </div>
      {% endif %}
    {% else %}
      <div class="product-media__placeholder">
        {{ 'product-1' | placeholder_svg_tag: 'placeholder-svg' }}
      </div>
    {% endif %}
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const thumbnails = document.querySelectorAll('.product-media__thumbnail');
    const mainImage = document.getElementById('product-featured-image');

    thumbnails.forEach(function(thumbnail) {
      thumbnail.addEventListener('click', function() {
        const imageUrl = this.getAttribute('data-image-url');
        if (mainImage && imageUrl) mainImage.src = imageUrl;
        thumbnails.forEach(function(t) { t.classList.remove('active'); });
        this.classList.add('active');
      });
    });
  });
</script>
